<div class="modal fade" id="regist_modal">
    <div class="modal-dialog" style="top: 15%;">
      <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            {% if info %}
            <h4 class="modal-title">Modify Place</h4>
            {% else %}
            <h4 class="modal-title">Regist Place</h4>
            {% endif %}
        </div>
        <div class="modal-body" style="height: 350px;">
            <form id="regi_form">
                <div class="form-group" id="form-group1">
                    <label for="ipt_name" id="lab_name">상호명</label>
                    <div class="dropdown">
                        <input type="text" class="form-control dropdown-toggle" id="ipt_name" value="" placeholder="입력 후 엔터" data-trigger="manual" data-toggle="tooltip" data-placement=top title="해당 데이터가 존재하지 않습니다.">
                        <ul class="dropdown-menu" role="menu" id="view_list" style="width: 100%;"></ul>
                    </div>
                </div>
                <div class="form-inline form-group">
                    <div class="form-group" style="width: 50%;">
                        <label for="p_addr" class="lab_addr">주소</label>
                        <p class="form-control-static pad-left-10" id="p_addr"></p>
                    </div>
                    <div class="form-group" style="width: 49%;">
                        <label for="p_tel" class="lab_tel">전화번호</label>
                        <p class="form-control-static pad-left-10" id="p_tel"></p>
                        <input type="hidden" id="ipt_tel" class="pad-left-10 form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label for="ipt_tag" id="lab_tag">태그</label>
                    <div class="new-tag ">
                        <div class="tags">
                            <input type="text" placeholder="add a new tag" class="new-tag-input form-control">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="ipt_memo" id="lab_memo">한줄평</label>
                    <textarea class="form-control" rows="3" id="ipt_memo"></textarea>
                </div>
                <div class="form-inline form-group">
                    <label for="chkbox_off" id="lab_off_day" >휴무일</label>
                    <div class="checkbox mar-left-10">
                        <label>
                            <input type="checkbox" value="" id="chkbox_off" class="vertical_middle">
                            연중무휴
                        </label>
                    </div>
                    <button type="button" class="btn btn-info btn-xs mar-left-10" id="add_off"> 추가 </button>
                    <div class="mar-bot-10 form-group" id="chk_off">
                        <div class="btn-group" data-toggle="buttons" id="chk_off_week">
                            <label class="btn btn-default wid25">
                                <input type="checkbox" name="chk_off_week" autocomplete="off" value="1"> 첫째주
                            </label>
                            <label class="btn btn-default wid25">
                                <input type="checkbox" name="chk_off_week" autocomplete="off" value="2"> 둘째주
                            </label>
                            <label class="btn btn-default wid25">
                                <input type="checkbox" name="chk_off_week" autocomplete="off" value="3"> 셋째주
                            </label>
                            <label class="btn btn-default wid25">
                                <input type="checkbox" name="chk_off_week" autocomplete="off" value="4"> 넷째주
                            </label>
                        </div>
                        <div class="btn-group" data-toggle="buttons" id="chk_off_day">
                            <label class="btn btn-default wid15">
                                <input type="radio" name="rdo_off_day" autocomplete="off" value="MON"> 월
                            </label>
                            <label class="btn btn-default wid15">
                                <input type="radio" name="rdo_off_day" autocomplete="off" value="TUE"> 화
                            </label>
                            <label class="btn btn-default wid15">
                                <input type="radio" name="rdo_off_day" autocomplete="off" value="WED"> 수
                            </label>
                            <label class="btn btn-default wid15">
                                <input type="radio" name="rdo_off_day" autocomplete="off" value="THU"> 목
                            </label>
                            <label class="btn btn-default wid15">
                                <input type="radio" name="rdo_off_day" autocomplete="off" value="FRI"> 금
                            </label>
                            <label class="btn btn-default wid15">
                                <input type="radio" name="rdo_off_day" autocomplete="off" value="SAT"> 토
                            </label>
                            <label class="btn btn-default wid15">
                                <input type="radio" name="rdo_off_day" autocomplete="off" value="SUN"> 일
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-inline form-group">
                    <div id="div_off_list">
                    </div>
                </div>
                <label for="" id="lab_sales_time">영업시간</label>
                <div class="form-inline form-group">
                    <div class="form-group" style="width: 50%;">
                        <label for="ipt_sales_time_from" id="lab_sales_time_from" style="width: 18%;">FROM</label>
                        <div id="ipt_sales_time_from" class="form-control"></div>
                    </div>
                    <div class="form-group" style="width: 49%;">
                        <label for="ipt_sales_time_to" class="lab_sales_time_to text-center" style="width: 18%;">TO</label>
                        <div id="ipt_sales_time_to" class="form-control"></div>
                    </div>
                </div>
                <div class="form-inline form-group mar-0">
                    <label for="chkbox_break" id="lab_break_time">Break Time</label>
                    <div class="checkbox mar-left-10">
                        <label>
                            <input type="checkbox" value="" id="chkbox_break" class="vertical_middle">
                            없음
                        </label>
                    </div>
                </div>
                <div class="form-inline form-group" id="div_break_time">
                    <div class="form-group" style="width: 50%;">
                        <label for="ipt_break_time_from" id="lab_break_time_from" style="width: 18%;">FROM</label>
                        <div id="ipt_break_time_from" class="form-control"></div>
                    </div>
                    <div class="form-group" style="width: 49%;">
                        <label for="ipt_break_time_to" class="lab_break_time text-center" style="width: 18%;">TO</label>
                        <div id="ipt_break_time_to" class="form-control"></div>
                    </div>
                </div>
                <div class="form-inline form-group">
                    <div class="form-group" style="width: 49%;">
                        <label for="sel_type" id="lab_type" style="width: 25%;" >음식유형</label>
                        <div id="sel_type" style="display: inline-block; vertical-align: middle;"></div>
                    </div>
                    <div class="form-group" style="width: 49%;">
                        <label for="sel_sub_type" id="lab_sub_type" style="width: 25%;">대표나라</label>
                        <div id="sel_sub_type" style="display: inline-block; vertical-align: middle;"></div>
                    </div>
                </div>
                <div class="form-inline form-group mar-0">
                    <label for="rdo_parking" id="lab_try">주차 가능 여부</label>
                    <div class="checkbox mar-left-10">
                        <label><input type="radio" name="rdo_parking" id="rdo_parking_t" value="TRUE" />가능</label>
                        <label class="mar-left-10"><input type="radio" id="rdo_parking_f" name="rdo_parking" value="FALSE" />불가능</label>
                    </div>
                </div>
                <div class="form-inline form-group mar-0">
                    <label for="chkbox_try" id="lab_try">가서 먹어본 적 있음</label>
                    <div class="checkbox mar-left-10">
                        <label>
                            <input type="checkbox" value="" id="chkbox_try" class="vertical_middle" >
                        </label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-bebeemap" id="btn_save">Save</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<script type="text/javascript">
var MODAL = {
    param_name: "",
    view_list : $("#view_list"),
    mat_data : null,
    sub_type_list : null,
    serch_zip : null,
    name_ipt_tooltip: false,
    modalInit: function(name) {
        param_name = name;
        modal_getSubTypeList();
        MODAL.inputInit();
        MODAL.dateTimeInit();
        MODAL.modalEventBind();
        MODAL.dropdownInit();
        if("{{ info2|escapejs }}" != "") {
            MODAL.ifModifyInit(DTL.info);
        }
    },
    inputInit: function() {
        if(param_name != "") {
            $("#ipt_name").val(param_name);
            var ps = new daum.maps.services.Places();
            ps.keywordSearch(param_name, placesSearchCB);
        }
    },
    dateTimeInit: function() {
        var elements = ["#ipt_sales_time_from", "#ipt_sales_time_to", "#ipt_break_time_from", "#ipt_break_time_to"];
        for(var i in elements) {
            modal_creatDateTime(elements[i]);
        }
    },
    dropdownInit: function() {
        var typeSource = [
            {"KO_DESC": "식사", "TYPE": "M"}, 
            {"KO_DESC": "음주", "TYPE": "A"}, 
            {"KO_DESC": "디저트", "TYPE": "D"}
        ];
        modal_creatDropDown("#sel_type", typeSource);

        var subTypeSource = MODAL.sub_type_list;
        modal_creatDropDown("#sel_sub_type", subTypeSource);
    },
    ifModifyInit: function(info) {
        $("#ipt_name").val(info.NAME);
        if("{{ info2|escapejs }}" != "") {
            $("#ipt_name").attr("disabled", true);
        }
        $("#p_addr").text(info.RN_ADDR);
        $("#p_tel").text(info.TEL);
        $("#ipt_memo").val(info.DESC);

        for(var i in info.TAG) {
            var tagStr = info.TAG[i].substring(1);
            var html = '<div class="tag added">';
                html += info.TAG[i];
                html += '<input type="checkbox" name="tags" value="'+ tagStr +'" checked="checked">';
                html += '</div>';
            $(".tags").prepend(html);
        }

        $(".tag.added").click(function() {
            if ($(this).hasClass('to-be-crossed')) {
                return $(this).remove();
            } else {
                return $(this).addClass('to-be-crossed');
            }
        });

        if(info.OFF_DAY == null || info.OFF_DAY.length == 0) {
            $("#chkbox_off").prop("checked", true);
            $("#chk_off").hide();
        } else {
            for(var i in info.OFF_DAY) {
                var html = '<span class="dtl_label dtl_label_info">' + info.OFF_DAY[i] + '<i class="fas fa-times mar-left-10"></i></span>';
                $("#div_off_list").append(html);
            }
        }

        $("#div_off_list .dtl_label .fa-times").click(function() {
            $($(this).parent()).remove();
        });

        if(info.SALES_FROM != null && info.SALES_FROM != "") {
            $("#ipt_sales_time_from").val(info.SALES_FROM);
        }

        if(info.SALES_TO != null && info.SALES_TO != "") {
            $("#ipt_sales_time_to").val(info.SALES_TO);
        }

        if(info.BREAK_FROM != null && info.BREAK_FROM != "") {
            $("#ipt_break_time_from").val(info.BREAK_FROM);
        }

        if(info.BREAK_TO != null && info.BREAK_TO != "") {
            $("#ipt_break_time_to").val(info.BREAK_TO);
        }

        if(info.BREAK_TO == null || info.BREAK_TO == "" || info.BREAK_FROM == null || info.BREAK_FROM == "") {
            $("#chkbox_break").prop("checked", true);
            $("#div_break_time").hide();
        }

        if(info.TYPE != null && info.TYPE != "") {
            $("#sel_type").jqxDropDownList('selectItem', info.TYPE);
        }

        if(info.SUB_TYPE != null && info.SUB_TYPE != "") {
            $("#sel_sub_type").jqxDropDownList('selectItem', info.SUB_TYPE);
        }

        if(info.PARKING == "TRUE") {
            $("#rdo_parking_t").prop("checked", true);
        } else if(info.PARKING == "FALSE") {
            $("#rdo_parking_f").prop("checked", true);
        }

        if(info.TRY == "TRUE") {
            $("#chkbox_try").prop("checked", true);
        }
    },
    modalEventBind: function() {
        
        // 상호명 쓰고 엔터 쳤을때 검색
        $("#ipt_name").keypress(function(e) {
            if(e.which == 13) {
                if($(this).val() != null && $(this).val() != "") {
                    var ps = new daum.maps.services.Places();
                    ps.keywordSearch($(this).val(), placesSearchCB);
                } else {
                    $("#p_addr").text("");
                    $("#p_tel").text("");

                    alert("조회할 상호명을 입력 후 엔터");
                }
            }
        });

        // 상호명에서 포커스아웃되었을때 리스트 없애기
        $("#ipt_name").focusout(function() {
            var thisVal = $(this).val();
            if(thisVal == "" || thisVal == null) {
                MODAL.view_list.empty();
                MODAL.view_list.css("display", "none");
            } 

            if($("#view_list").css("display") == "none" && thisVal != "") {
                var ps = new daum.maps.services.Places();
                ps.keywordSearch(thisVal, placesSearchCB);
            } 
        });

        // 저장
        $("#btn_save").click(function() {
            MODAL.modalSave();
        });

        $('#ipt_name').on('show.bs.tooltip', function () {
            MODAL.name_ipt_tooltip = true;
        });

        $('#ipt_name').on('hide.bs.tooltip', function () {
            MODAL.name_ipt_tooltip = false;
        });

        $('#chkbox_off').change(function() {
            if($(this).is(":checked")) {
                $("#chk_off").hide();
            } else {
                $("#chk_off").show();
            }
                
        });

        $('#chkbox_break').change(function() {
            if($(this).is(":checked")) {
                $("#div_break_time").hide();
            } else {
                $("#div_break_time").show();
            }
                
        });

        $("#add_off").click(function() {
            flag = true;
            if($("input[name='rdo_off_day']").is(":checked")) {
                var day = $("input[name='rdo_off_day']:checked").val();
                var value = "";
                var weeks = [];
                if($('input[name=chk_off_week]:checked').length != 0) {
                    var ele = $('input[name=chk_off_week]:checked');
                    for(var i = 0; i < ele.length; i++) {
                        weeks.push($(ele[i]).val());
                    }
                    value = day + "(" + weeks.join(",") + ")";
                } else {
                    value = day;
                }

                var html = '<span class="dtl_label dtl_label_info">' + value + '<i class="fas fa-times mar-left-10"></i></span>';

                var lab_off_list = $("#div_off_list .dtl_label");
                if(lab_off_list.length != 0) {
                    for(var i = 0; i < lab_off_list.length; i++) {
                        if($(lab_off_list[i]).text().substr(0, 3) == day) {
                            alert("중복된 요일이 있습니다.");
                            flag = false;
                            return;
                        }
                        if($(lab_off_list[i]).text() == value) {
                            alert("중복된 값이 있습니다.");
                            flag = false;
                            return;
                        }

                    }
                }
                if(flag) {
                    $("#div_off_list").append(html);
                    var chk_off_week = $("#chk_off_week").children();
                    for(var i = 0; i < chk_off_week.length; i++) {
                        $(chk_off_week[i]).removeClass("active");
                    }

                    var chk_off_day = $("#chk_off_day").children();
                    for(var i = 0; i < chk_off_day.length; i++) {
                        $(chk_off_day[i]).removeClass("active");
                    }
                }
            } else {
                alert("추가할 휴무일을 지정해주세요.");
                flag = false;
                return;
            }
            $("#div_off_list .dtl_label .fa-times").click(function() {
                $($(this).parent()).remove();
            });
        });

    },
    formReset: function() {
        $("#ipt_name").val("");
        $("#p_addr").text("");
        $("#p_tel").text("");
        $("#ipt_tel").val("");

        var tag = $(".tag.added");
        for(var i = 0; i < tag.length; i++) {
            $(tag[i]).remove();
        }
        $(".new-tag-input").val("");

        $("#ipt_memo").val("");

        var offWeek = $("#chk_off_week").children();
        for(var i = 0; i < offWeek.length; i++) {
            $(offWeek[i]).removeClass("active");
        }

        var offDay = $("#chk_off_day").children();
        for(var i = 0; i < offDay.length; i++) {
            $(offDay[i]).removeClass("active");
        }

        var dateTimeEle = ["#ipt_sales_time_from", "#ipt_sales_time_to", "#ipt_break_time_from", "#ipt_break_time_to"];
        for(var i in dateTimeEle) {
            modal_clearDateTime(dateTimeEle[i]);
        }
        modal_clearDropDown("#sel_type");
        modal_clearDropDown("#sel_sub_type");

        if($("#view_list").css("display") != "none") {
            $("#view_list").css("display", "none")
        }

        if($("#chkbox_off").is(":checked")) {
            $("#chkbox_off").prop("checked", false);
            $("#chk_off").show();
        }

        if($("#chkbox_break").is(":checked")) {
            $("#chkbox_break").prop("checked", false);
            $("#div_break_time").show();
        }

        $("#div_off_list").empty();
    },
    getModalSaveData: function() {
        var returnObj = new Object();
        returnObj.user = "{{user.id}}"
        returnObj.NAME = $("#ipt_name").val();
        returnObj.RN_ADDR = $("#p_addr").text();

        if(MODAL.mat_data != null) {
            var lbAddrArr = MODAL.mat_data.address_name.split(" ");
            lbAddrArr.splice(0, 2);
            returnObj.LB_ADDR = lbAddrArr.join(" ");
        } else if("{{ info2|escapejs }}" != "") {
            returnObj.LB_ADDR = DTL.info.LB_ADDR;
        }

        returnObj.TEL = $("#p_tel").text();
        
        returnObj.location = {
            lat: null,
            lon: null
        };

        if(MODAL.mat_data != null) {
            returnObj.location.lat = MODAL.mat_data.y*1;
            returnObj.location.lon = MODAL.mat_data.x*1;
        } 
        
        if("{{ info2|escapejs }}" != "") {
            console.log(DTL.info.location.lat, DTL.info.location.lon)
            returnObj.location.lat = DTL.info.location.lat*1;
            returnObj.location.lon = DTL.info.location.lon*1;
        }
        
        var tagAdded = $(".tag.added");
        returnObj.TAG = new Array();
        for(var i in tagAdded) {
            if(!isNaN(i*1)) {
                returnObj.TAG.push($(tagAdded[i]).text());
            }
        }
        
        returnObj.DESC = $("#ipt_memo").val();

        if(!$("#chkbox_off").is(":checked")) {
            returnObj.OFF_DAY = [];
            var off_list = $("#div_off_list .dtl_label");
            if(off_list.length != 0) {
                for(var i = 0; i < off_list.length; i++) {
                    returnObj.OFF_DAY.push($(off_list[i]).text());
                }
            } else {
                var day = $("input[name='rdo_off_day']:checked").val();
                if(day != null) {
                    var value = "";
                    var weeks = [];
                    if($('input[name=chk_off_week]:checked').length != 0) {
                        var ele = $('input[name=chk_off_week]:checked');
                        for(var i = 0; i < ele.length; i++) {
                            weeks.push($(ele[i]).val());
                        }
                        value = day + "(" + weeks.join(",") + ")";
                    } else {
                        value = day;
                    }

                    returnObj.OFF_DAY.push(value);
                }
            }

        }
        returnObj.SALES_FROM = $("#ipt_sales_time_from").val();
        returnObj.SALES_TO = $("#ipt_sales_time_to").val();
        
        if(!$("#chkbox_break").is(":checked")) {
            returnObj.BREAK_FROM = $("#ipt_break_time_from").val();
            returnObj.BREAK_TO = $("#ipt_break_time_to").val();
        }

        returnObj.TYPE = $("#sel_type").val();
        returnObj.SUB_TYPE = $("#sel_sub_type").val();
        returnObj.TRY = $("#chkbox_try").is(":checked").toString().toUpperCase();
        returnObj.PARKING = $(":input:radio[name=rdo_parking]:checked").val();
        // returnObj.csrfmiddlewaretoken = MODAL.csrftoken

        return returnObj;

    },
    modalValidation: function() {
        if($("#ipt_name").val() == null || $("#ipt_name").val() == "") {
            alert("상호명을 입력하세요.");
            return false;
        }

        if($("#p_addr").text() == "" && $("#p_tel").text() == "") {
            alert("상호명을 입력 후 선택해주세요.");
            return false;
        }
        
        var flag = true;
        if("{{ info2|escapejs }}" != "") {
            var oriData = new Object;
            var newData = MODAL.getModalSaveData();
            $.each(newData, function(k, v) {
                $.each(DTL.info, function(k2, v2) {
                    if(k == k2) {
                        if(k == 'SALES_FROM' || k == 'SALES_TO' || k == 'BREAK_FROM' || k == 'BREAK_TO' ) {
                            oriData[k] = toHHMM(v2);
                        } else {
                            oriData[k] = v2;
                        }
                    }
                });
            });
            
            if(newData.hasOwnProperty('OFF_DAY')) {
                oriData.OFF_DAY = oriData.OFF_DAY.sort();
                newData.OFF_DAY = newData.OFF_DAY.sort();
            }
            if(newData.hasOwnProperty('TAG')) {
                oriData.TAG = oriData.TAG.sort();
                newData.TAG = newData.TAG.sort();
            }

            if(Object.equals(newData, oriData)) {
                alert("수정된 데이터가 없습니다.");
                return false;
            }
        }
        
        return true;
    },
    modalSave: function() {
        //MODAL.modalValidation();
        if (MODAL.modalValidation()) {
            var paramUrl = '/api/enroll_map/';
            var paramData = MODAL.getModalSaveData();
            var confirmMsg = "등록하시겠습니까?";

            if("{{ info2|escapejs }}" != "") {
                paramUrl = '/api/modify_map/';
                paramData.ID = DTL.info.ID;
                confirmMsg = "수정하시겠습니까?";
            }
            if(confirm(confirmMsg)) {

                $.ajax({
                    url: paramUrl,
                    headers: { 'Content-Type':'text/plain; charset=utf-8' },
                    dataType:'text',
                    type:'POST',
                    data: JSON.stringify(paramData),
                    success:function(result){
                        if(result) {
                            $("#regist_modal").modal('hide');
                        }
                    }
                });
            }
        }
    }
}

// 키워드 검색 완료 시 호출되는 콜백함수
function placesSearchCB (data, status, pagination) {
    MODAL.view_list.empty();
    if (status === daum.maps.services.Status.OK) {
        if(MODAL.name_ipt_tooltip) {
            $("#ipt_name").tooltip('hide');
        }

        if($("#form-group1").hasClass("has-error")) {
            $("#form-group1").removeClass("has-error");
        }
        
        MODAL.serch_zip = [];
        for(var i in data) {
            var cate = data[i].category_name.split(" > ");
            if(cate[0] == "음식점" || cate[cate.length-1] == "식품판매") {
                MODAL.serch_zip.push(data[i]);
            }
        }
        
        if(MODAL.serch_zip.length != 0 && data.length != 0 ) {
            for(var i in MODAL.serch_zip) {
                var list = '<li role="presentation" class="menu_item">'
                    list += '<a role="menuitem" tabindex="-1">'
                    list += "( " + (Number(i)+1) + " ) " + MODAL.serch_zip[i].place_name + " / " + MODAL.serch_zip[i].road_address_name
                    list += '</a>';
                    list += '<span hidden="true">' + JSON.stringify(MODAL.serch_zip[i]) + '</span>'
                    list += '</li>';

                MODAL.view_list.append(list);
                MODAL.view_list.css("display", "block");
            }
        } else {
            if(!$("#form-group1").hasClass("has-error")) {
                $("#form-group1").addClass("has-error");
            }

            if(!MODAL.name_ipt_tooltip) {
                $("#ipt_name").tooltip('show');
            }

            if(MODAL.view_list.css("display") == "block") {
                MODAL.view_list.css("display", "none");
            }
        }


        $(".menu_item").click(function() {
            MODAL.mat_data = JSON.parse($(this).children("span").text());
            
            $.ajax({
                url:'/api/searchGetEs?lat=' + MODAL.mat_data.y + '&lng=' + MODAL.mat_data.x,
                dataType:'json',
                type:'GET',
                async: false,
                success:function(result){
                    console.log(result)
                    if(result.length != 0) {
                        if(!alert("저장된 데이터가 있습니다. 불러오시겠습니까?")) {
                            // MODAL.formReset();
                            // MODAL.dropdownInit();
                            MODAL.ifModifyInit(result[0]._source)
                        }
                    } else {
                        console.log(MODAL.mat_data);
                        $("#ipt_name").val(MODAL.mat_data.place_name);
                        $("#p_addr").text(MODAL.mat_data.road_address_name);

                        if(MODAL.mat_data.phone == "" || MODAL.mat_data.phone == null) {
                            $("#p_tel").text("").attr("hidden", "true");
                            $("#ipt_tel").prop("type", "number");
                        } else {
                            $("#ipt_tel").prop("type", "hidden");
                            $("#p_tel").removeAttr("hidden").text(MODAL.mat_data.phone);
                        }
                        
                    }
                }
            });

            MODAL.view_list.empty();
            MODAL.view_list.css("display", "none");
        });
    } else {
        if(!$("#form-group1").hasClass("has-error")) {
            $("#form-group1").addClass("has-error");
        }

        if(!MODAL.name_ipt_tooltip) {
            $("#ipt_name").tooltip('show');
        }

        if(MODAL.view_list.css("display") == "block") {
            MODAL.view_list.css("display", "none");
        }
    }
}

function modal_creatDateTime(element) {
    $(element).jqxDateTimeInput({
        dropDownVerticalAlignment: "top",
        formatString: "HH:mm", 
        showTimeButton: true, 
        showCalendarButton: false, 
        width: '195px', 
        height: '32px',
        animationType: 'slide',
        theme: 'material-purple',
        template: "default"
    });
}

function modal_clearDateTime(element) {
    var time = new Date();
    time.setHours(0);
    time.setMinutes(0);
    $(element).jqxDateTimeInput("setDate", time); 
}

function modal_creatDropDown(element, source) {
    $(element).jqxDropDownList({
        width: '195px', 
        height: '36px',
        theme: 'material-purple',
        dropDownVerticalAlignment: 'top',
        autoDropDownHeight: true,
        source: source,
        displayMember: "KO_DESC",
        valueMember: "TYPE"
    });
}

function modal_clearDropDown(element) {
    $(element).jqxDropDownList('clear');
}

function modal_getSubTypeList() {
    $.ajax({
        url:'/api/sub_type_list',
        dataType:'json',
        type:'GET',
        async: false,
        success:function(result){
            MODAL.sub_type_list = result;
        }
    });
}

Object.equals = function( x, y ) {
  if ( x === y ) return true;
    // if both x and y are null or undefined and exactly the same

  if ( ! ( x instanceof Object ) || ! ( y instanceof Object ) ) return false;
    // if they are not strictly equal, they both need to be Objects

  if ( x.constructor !== y.constructor ) return false;
    // they must have the exact same prototype chain, the closest we can do is
    // test there constructor.

  for ( var p in x ) {
    if ( ! x.hasOwnProperty( p ) ) continue;
      // other properties were tested using x.constructor === y.constructor

    if ( ! y.hasOwnProperty( p ) ) return false;
      // allows to compare x[ p ] and y[ p ] when set to undefined

    if ( x[ p ] === y[ p ] ) continue;
      // if they have the same strict value or identity then they are equal

    if ( typeof( x[ p ] ) !== "object" ) return false;
      // Numbers, Strings, Functions, Booleans must be strictly equal

    if ( ! Object.equals( x[ p ],  y[ p ] ) ) return false;
      // Objects and Arrays must be tested recursively
  }

  for ( p in y ) {
    if ( y.hasOwnProperty( p ) && ! x.hasOwnProperty( p ) ) return false;
      // allows x[ p ] to be set to undefined
  }
  return true;
}

function toHHMM(time) {
    var times = time.split(":");

    return twoNum(times[0]) + ":" + twoNum(times[1]);
}

function twoNum(numStr) {
    if(numStr.length == 1) {
        numStr = "0" + numStr;
    }

    return numStr;
}
</script>